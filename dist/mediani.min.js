/*! 
Mediani v0.0.1 
(c) 2015 Antoni Putra 
 */
 
if("undefined"==typeof jQuery)throw new Error("Mediani Js requires jQuery");!function(t){var e='<a class="thumbnail mediani-item" style="display: inline-block; width: 200px; height: 300px; overflow: hidden;">\n 	<img src="<%=image_url%>" />\n 	<div class="caption text-left"> \n 		<h3><%=title%></h3> \n 		<p><%=description%></p> \n 	</div> \n </a>',n='<a class="btn btn-primary mediani-button"> \n 	Browse \n </a>',i=function(t,e){self=this,this.$elem=t,this.options=e,this.render()};i.prototype={createUniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},showModal:function(){self=this,$modal=t(self.options.template.modal),$modal.modal("show"),self.getModalContent().html(self.options.template.loading),loadApi=t.ajax(self.options.apiUrl,{data:self.options.apiUrlParams||"",cache:!1,type:"GET"}),loadApi.fail(function(t,e){console.log("Couldn't Request to : "+self.options.apiUrl),self.getModalContent().html("Something went wrong")}),loadApi.success(function(t,e){self.getModalContent().html(""),self.renderItem(t)})},renderItem:function(e){return self=this,"object"!=typeof e||t.isEmptyObject(e)?(nodata="<p class='text-center'>Data tidak ada</p>",self.getModalContent().append(nodata)):(item=self.options.template.item,$content=self.getModalContent(),void t.each(e,function(e,n){elItem=tmpl(item,n),$elItem=t(elItem),$elItem.attr("data-value",n[self.options.resultNode]),t(".mediani-modal").on("click",".mediani-item",function(e){e.preventDefault(),e.stopImmediatePropagation(),self.selectSingleItem(t(this))}),$content.append($elItem)}))},selectSingleItem:function(e){self=this,self.$elem.attr("value",e.data("value")),self.options.template.preview?self.options.template.preview.html(e):self.$elem.css({position:"relative",visibility:"visible"}).attr({readonly:"1"}),$modal=t(self.options.template.modal),$modal.modal("hide")},getModalContent:function(){return t(this.options.template.content)},render:function(){self=this,self.$elem.css({position:"absolute",visibility:"hidden"}),button=t(self.options.template.button),self.$elem.after(button),button.on("click",function(t){t.preventDefault(),t.stopImmediatePropagation(),this.showModal()}.bind(self))}},t.fn.mediani=function(o){var l={apiUrl:"",apiUrlParams:"",resultNode:"title",template:{modal:".mediani-modal",content:".mediani-modal-content",button:n,preview:"",loading:'<p class="loading text-center">Loading</p>',item:e}};return t.isEmptyObject(o.resultNode)||(l.resultNode=o.resultNode),t.isEmptyObject(o.setItemTemplate)||(l.template.item=o.setItemTemplate),t.isEmptyObject(o.setButton)||(l.template.button=o.setButton),t.isEmptyObject(o.setPreview)||(l.template.preview=o.setPreview),t.isEmptyObject(o.setLoading)||(l.template.loading=o.setLoading),o=t.extend({},l,o),this.each(function(){new i(t(this),o)})};var o={};tmpl=function l(t,e){var n=/\W/.test(t)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+t.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):o[t]=o[t]||l(document.getElementById(t).innerHTML);return e?n(e):n}}(jQuery);