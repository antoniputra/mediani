/*! 
Mediani v0.0.1 
(c) 2015 Antoni Putra 
 */
 
if("undefined"==typeof jQuery)throw new Error("Mediani Js requires jQuery");!function(e){var t='<a class="thumbnail mediani-item" style="float: left; margin:4px 6px; max-width: 200px; height: 300px;">\n 	<img src="http://plensip.dev/uploads/medias/medium/article2.jpg" />\n 	<div class="caption"> \n 		<h3><%=title%></h3> \n 		<p><%=description%></p> \n 	</div> \n </a>',n='<a class="btn btn-primary mediani-button"> \n 	Browse \n </a>',i=function(e,t){self=this,this.$elem=e,this.options=t,this.render()};i.prototype={createUniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},showModal:function(){self=this,$modal=e(self.options.template.modal),$modal.modal("show"),self.getModalContent().html('<p class="loading text-center">Loading</p>'),loadApi=e.ajax(self.options.apiUrl,{data:self.options.apiUrlParams||"",cache:!1,type:"GET"}),loadApi.fail(function(e,t){console.log("Couldn't Request to : "+self.apiUrl),self.getModalContent().html("Something went wrong")}),loadApi.success(function(e,t){self.getModalContent().html(""),self.renderItem(e)})},renderItem:function(t){return self=this,"object"!=typeof t||e.isEmptyObject(t)?(nodata="<p class='text-center'>Data tidak ada</p>",self.getModalContent().append(nodata)):(item=self.options.template.item,nodeKey=self.options.apiNodes,$content=self.getModalContent(),e.each(t,function(t,n){elItem=tmpl(item,n),$elItem=e(elItem),$elItem.attr("data-value",n[self.options.resultNode]),e(".mediani-modal").on("click",".mediani-item",function(t){t.preventDefault(),t.stopImmediatePropagation(),self.selectSingleItem(e(this))}),$content.append($elItem)}),void 0)},selectSingleItem:function(t){self=this,console.log("hello "+t.data("value")),self.$elem.attr("value",t.data("value")),self.options.template.preview?(console.log(t),self.options.template.preview.html(t)):self.$elem.css({position:"relative",visibility:"visible"}),$modal=e(self.options.template.modal),$modal.modal("hide")},getModalContent:function(){return e(this.options.template.content)},render:function(){self=this,self.$elem.css({position:"absolute",visibility:"hidden"}),button=e(self.options.template.button),self.$elem.after(button),button.on("click",function(e){e.preventDefault(),e.stopImmediatePropagation(),this.showModal()}.bind(self))}},e.fn.mediani=function(o){var l={apiUrl:"http://plensip.dev/coba",apiUrlParams:"",apiNodes:{id:"id",title:"title",image:"",description:"description"},resultNode:"title",template:{modal:".mediani-modal",content:".mediani-modal-content",button:n,preview:"",item:t}};return e.isEmptyObject(o.resultNode)||(l.resultNode=o.resultNode),e.isEmptyObject(o.setItemTemplate)||(l.template.item=o.setItemTemplate),e.isEmptyObject(o.setPreview)||(l.template.preview=o.setPreview),o=e.extend({},l,o),console.log(o),this.each(function(){new i(e(this),o)})};var o={};tmpl=function l(e,t){var n=/\W/.test(e)?new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+e.replace(/[\r\t\n]/g," ").split("<%").join("	").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("	").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');"):o[e]=o[e]||l(document.getElementById(e).innerHTML);return t?n(t):n}}(jQuery);